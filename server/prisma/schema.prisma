datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Hymn {
  id         String   @id @default(uuid())
  title      String
  tags       Tag[]
  files      File[]
  lyric      Lyric?   // One-to-one optional relation
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Lyric {
  id         String   @id @default(uuid())
  hymn       Hymn     @relation(fields: [hymnId], references: [id], onDelete: Cascade)
  hymnId     String   @unique  // One lyric per hymn
  content    String   @db.Text
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Saying {
  id          String   @id @default(uuid())
  author      String
  authorImage String?
  source      String?
  content     String
  tags        Tag[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Tag {
  id        String   @id @default(uuid())
  name      String   @unique
  category  String?
  hymns     Hymn[]
  sayings   Saying[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model File {
  id           String   @id @default(uuid())
  hymn         Hymn     @relation(fields: [hymnId], references: [id], onDelete: Cascade)
  hymnId       String
  type         FileType
  fileUrl      String
  originalName String?  // Original filename (including Unicode chars like Arabic)
  size         Int?
  duration     Int?
  createdAt    DateTime @default(now())
}

enum FileType {
  VIDEO_MONTAGE
  VIDEO_POWERPOINT
  POWERPOINT
  MUSIC_AUDIO
}

model User {
  id        String   @id @default(uuid())
  username  String   @unique
  password  String
  role      Role     @default(EDITOR)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  logs      Log[]
}

model Log {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  action    String
  entity    String
  entityId  String?
  details   String?
  createdAt DateTime @default(now())
}

enum Role {
  ADMIN
  EDITOR
}
